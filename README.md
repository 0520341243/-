# 钉钉多群组定时提醒系统开发 - AI提示语

## 🎯 项目概述

请开发一个基于Web的企业级钉钉多群组定时提醒系统，支持多用户权限管理、按需激活群组和智能时间过滤功能。系统需要具备高扩展性、资源优化和云平台部署能力。

## 📋 核心功能需求

### 1. Excel提醒配置系统

**文件格式要求：**
- 支持Excel文件（.xlsx/.xls）上传，文件大小限制16MB
- 每个Excel包含多个工作表（如：子表1、子表2、子表5）
- 每个工作表对应独立的提醒计划
- 工作表必须包含两列：`时间`（HH:MM:SS或HH:MM格式）和`消息内容`（纯文本）

**星期工作表映射：**
- 用户可自定义每个星期对应的工作表名称
- 默认配置：周一至周四使用"子表1"，周五使用"子表2"，周末使用"子表5"
- 支持通过Web界面动态修改映射关系并持久化存储

### 2. 智能时间过滤机制

**核心要求：**
- 系统重新加载提醒计划时，自动跳过已过时间点的提醒，防止钉钉机器人被历史消息轰炸
- 使用系统本地时区进行时间比较，确保时区准确性（避免UTC时间问题）
- 过去时间的提醒自动标记为"已发送"状态，未来时间的提醒保持"待发送"状态

**触发场景：**
- 系统启动时自动应用智能过滤
- 用户手动点击"重新加载计划"时
- 临时计划立即启动时

### 3. 临时计划立即启动功能

**功能描述：**
- 支持上传临时Excel文件，可选择"立即启动"或"定时启动"两种模式
- 立即启动：上传后立即生效，同样应用智能时间过滤
- 定时启动：在次日02:00生效，文件使用后自动备份删除
- 临时文件优先级高于常规计划文件

**文件管理：**
- 提供临时文件状态监控（显示文件数量、创建时间）
- 支持一键清理临时文件功能
- 立即启动后可随时清理临时文件，不影响当天已加载的计划
- 清理临时文件后，点击"重新加载计划"可恢复常规计划

### 4. 多群组按需激活管理

**群组状态管理：**
- 🟢 运行中：正常执行定时提醒，占用系统资源
- 🟡 暂停：保留配置但不执行任务
- 🔴 停用：完全停用，不占用资源
- ⚪ 草稿：仅保存配置，未启用

**资源优化策略：**
- 系统负载 = 基础开销(128MB+0.1CPU) + 运行群组数 × 单群组开销(15-25MB+0.05CPU)
- 用户可控制最大同时运行群组数量
- 支持预创建大量群组配置（理论上限100个），但只有运行中的群组消耗资源
- 提供实时资源使用监控和群组状态可视化

**群组操作功能：**
- 一键启动/暂停/停用群组
- 支持批量操作多个群组
- 群组复制功能（基于现有群组创建新群组）
- 群组模板系统（预设和自定义模板）

### 5. 用户权限管理系统

**角色权限设计：**
- **管理员**：系统全局管理权限、创建/删除用户、管理所有群组、查看全局统计
- **普通用户**：仅管理自己创建的群组、查看个人统计、修改个人信息

**权限控制矩阵：**
- 用户只能由管理员创建
- 普通用户只能查看和管理自己创建的群组
- 管理员可以管理所有用户的群组
- 所有群组操作基于创建者ID进行权限过滤

**用户配额管理：**
- 普通用户群组数量限制（默认10个，可配置）
- 最大运行群组数限制（默认3个）
- 每日最大提醒数限制（默认200条）
- 配额使用情况实时监控和预警

### 6. 定时任务调度系统

**调度规则：**
- 每天02:00自动加载当天提醒计划
- 每分钟检查并发送到时的提醒消息
- 支持60-70条/日的提醒处理能力
- 分钟级时间精度执行

**多群组并发处理：**
- 同时为所有运行中群组执行定时任务
- 错峰执行避免系统负载峰值
- 单群组故障不影响其他群组运行
- 消息发送模块与计划读取模块解耦

### 7. 钉钉机器人集成

**接口要求：**
- 支持钉钉群机器人Webhook API
- 消息格式：纯文本类型
- 每个群组独立的Webhook配置
- 包含发送失败重试机制和错误日志记录

**配置管理：**
- 支持环境变量和界面配置两种方式
- 提供测试消息发送功能验证配置
- 钉钉连接状态实时监控

### 8. Web管理界面

**界面布局设计：**
- 顶部：系统状态栏 + 群组快速选择器 + 用户信息
- 左侧：群组列表 + 状态指示器 + 批量操作工具
- 主区域：当前选中群组的详细管理界面
- 底部：全局统计信息 + 资源使用监控

**功能模块：**
- **群组管理**：群组列表、状态控制、配置管理
- **文件管理**：常规文件上传、临时文件管理、状态监控
- **用户管理**：用户列表、权限设置、配额管理（管理员）
- **系统监控**：资源使用、提醒统计、操作日志
- **个人中心**：个人信息、密码修改、配额查看

**用户体验要求：**
- 响应式设计，支持桌面和移动端访问
- 实时状态更新，自动刷新机制（30秒提醒计划，2分钟临时文件状态）
- 友好的操作反馈和错误提示
- 现代化UI设计，直观的视觉指示

## 🔧 技术架构要求

### 后端技术栈

**Web框架要求：**
- 支持RESTful API设计，完整的CRUD操作
- 文件上传处理能力，支持多文件和拖拽上传
- 静态文件服务和模板渲染
- 跨域请求处理(CORS)支持

**身份认证与授权：**
- JWT Token或Session会话管理
- 基于角色的权限控制(RBAC)
- 资源所有权检查中间件
- 安全策略：登录失败限制、会话超时、密码复杂度

**数据存储设计：**
- 关系型数据库支持（SQLite/PostgreSQL/MySQL）
- 数据表设计：用户表、群组表、提醒计划表、配置表、审计日志表
- 数据库索引优化，支持多群组高效查询
- 事务处理确保数据一致性

**任务调度系统：**
- 支持cron-style定时任务调度
- 多线程或异步处理能力
- 后台服务稳定运行，daemon模式
- 任务状态监控和异常处理

**Excel文件处理：**
- Excel文件读取和解析库支持
- 多工作表数据提取
- 数据类型自动识别和转换
- 文件格式验证和错误处理

### 前端技术栈

**基础技术要求：**
- 现代Web标准（HTML5/CSS3/ES6+）
- 响应式布局设计，Bootstrap或类似框架
- 异步HTTP请求处理（Ajax/Fetch API）
- 前端路由管理（如果是SPA）

**用户交互功能：**
- 文件拖拽上传支持
- 实时状态更新显示
- 表单验证和数据绑定
- 模态对话框和消息通知
- 数据表格排序、筛选、分页

**状态管理：**
- 用户登录状态管理
- 群组选择状态保持
- 实时数据更新机制
- 客户端数据缓存策略

## 🚀 部署与运维要求

### 云平台兼容性

**Cloudflare部署适配：**
- 支持Cloudflare Workers/Pages部署
- 静态文件CDN分发优化
- 环境变量配置支持
- Serverless/Edge函数兼容性

**容器化部署：**
- Docker容器化支持
- docker-compose编排文件
- 持久化存储卷配置
- 健康检查和自动重启

**传统服务器部署：**
- 支持Linux/Windows服务器
- 系统服务配置（systemd/Windows Service）
- 反向代理配置（Nginx/Apache）
- SSL证书配置支持

### 配置管理

**环境配置：**
- 12-factor应用设计原则
- 环境变量注入支持
- 配置文件外部化
- 不同环境配置隔离（开发/测试/生产）

**监控与日志：**
- 结构化日志记录（JSON格式）
- 日志级别可配置
- 错误异常追踪
- 性能指标监控
- 健康检查API端点

## 📊 性能与安全要求

### 性能指标

**系统性能：**
- 单实例支持并发用户数：10-50人
- API响应时间：<2秒
- 内存使用：基础<256MB，每增加5个运行群组+100MB
- CPU使用：基础10%，每群组+5%

**数据处理能力：**
- 单日提醒处理量：1000+条
- Excel文件解析时间：<5秒（1000行数据）
- 数据库查询响应：<500ms
- 并发任务执行能力：20+群组

### 安全要求

**数据安全：**
- 密码哈希存储（bcrypt/scrypt）
- 敏感信息加密（Webhook地址等）
- SQL注入防护
- XSS攻击防护
- CSRF保护

**访问控制：**
- 文件类型和大小校验
- 上传文件安全扫描
- API调用频率限制
- 会话劫持防护
- 异常登录检测

## 🧪 质量保证要求

### 功能测试

**核心功能验证：**
- 智能时间过滤准确性测试（不同时区）
- 临时计划立即启动功能测试
- 多群组并发提醒测试
- 用户权限隔离测试
- 钉钉消息发送成功率测试

**边界测试：**
- 大量提醒任务处理能力（100+条/日）
- 异常Excel文件格式处理
- 网络中断恢复机制
- 长时间运行稳定性测试
- 并发用户访问测试

### 代码质量

**开发规范：**
- 代码注释覆盖率>50%
- 函数模块化设计
- 错误处理完整性
- 代码安全性检查
- 性能优化实践

## 📚 交付物要求

### 必需交付物

1. **完整源代码**
   - 前端代码（HTML/CSS/JavaScript）
   - 后端代码（包含所有API接口）
   - 数据库schema和初始化脚本
   - 配置文件和环境变量模板

2. **部署文档**
   - 详细安装配置说明
   - 依赖环境要求
   - Docker部署指南
   - Cloudflare部署步骤
   - 故障排除指南

3. **用户文档**
   - Excel模板制作指南
   - 系统使用手册
   - 权限管理说明
   - 常见问题解答

4. **技术文档**
   - API接口文档
   - 数据库设计文档
   - 系统架构图
   - 安全配置指南

5. **测试工具**
   - 功能测试脚本
   - 性能测试工具
   - API调试脚本
   - 数据迁移工具

### 可选增强功能

- 数据导出功能（Excel/CSV格式）
- 群组统计报表和图表展示
- 微信企业群机器人支持
- 多语言界面支持
- 移动端App或PWA版本

## 🔄 开发优先级

### 第一阶段：核心功能（MVP）
- 用户认证和基础权限管理
- 单群组Excel提醒配置
- 智能时间过滤机制
- 钉钉消息发送功能
- 基础Web管理界面

### 第二阶段：多群组功能
- 多群组管理系统
- 按需激活机制
- 群组状态管理
- 资源监控功能
- 用户配额管理

### 第三阶段：高级功能
- 临时计划立即启动
- 批量操作功能
- 高级统计分析
- 审计日志系统
- 性能优化和监控

## 💡 成功验收标准

- ✅ 支持多用户安全登录和权限隔离
- ✅ 单系统管理100+群组配置，用户可控制实际运行数量
- ✅ 智能时间过滤100%准确，无历史消息干扰
- ✅ 临时文件立即启动功能正常工作
- ✅ 钉钉消息发送成功率>99%
- ✅ 系统在2GB内存服务器上稳定运行
- ✅ 支持云平台（Cloudflare等）部署
- ✅ 完整的用户文档和部署指南

---

**重要提示：** 本系统设计为企业内部使用的自动化提醒工具，请确保代码具有良好的可维护性、扩展性和安全性。所有敏感信息（如钉钉Webhook地址）必须加密存储，用户权限控制必须严格执行。
